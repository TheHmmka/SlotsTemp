<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Slots2</title>
  <style>
  #loading-overlay{
    position: fixed;
    inset: 0;
    display: flex;
    flex-direction: column;
    gap: 14px;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.65);
    z-index: 9999;
    opacity: 1;
    transition: opacity .25s ease;
    pointer-events: all;
  }
  #loading-overlay.hidden{
    opacity: 0;
    pointer-events: none;
  }
  .spinner{
    width: 56px;
    height: 56px;
    border-radius: 50%;
    border: 5px solid rgba(255,255,255,0.22);
    border-top-color: rgba(255,255,255,0.95);
    animation: spin .9s linear infinite;
  }
  @keyframes spin{ to { transform: rotate(360deg); } }
  .loading-text{
    font: 600 16px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Arial;
    color: rgba(255,255,255,0.95);
  }
  .loading-subtext{
    font: 400 13px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Arial;
    color: rgba(255,255,255,0.7);
    max-width: 80vw;
    text-align: center;
  }
</style>
</head>

<body style="
  margin: 0;
  padding: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  background: black;
">
  <canvas
    id="unity-canvas"
    tabindex="-1"
    style="
      display: block;
      width: 100vw;
      height: 100vh;
      background: black;
    ">
  </canvas>

  <div id="loading-overlay" aria-live="polite">
    <div class="spinner" role="status" aria-label="Loading"></div>
    <div class="loading-text">Loading…</div>
    <div class="loading-subtext" id="loading-subtext"></div>
  </div>

  <script>
    // Папка билда по умолчанию
    const buildUrl = "Build";
    const loaderUrl = buildUrl + "/Web.loader.js";

    function getInitParams() {
      const url = new URL(window.location.href);
      const currency = url.searchParams.get("currency") || "EUR";
      const balanceStr = url.searchParams.get("balance") || "0";
      const balance = Number(balanceStr);
      const betStr = url.searchParams.get("bet") || "0";
      const bet = Number(betStr);

      return {
        currency,
        balance: Number.isFinite(balance) ? balance : 0,
        bet: Number.isFinite(bet) ? bet : 0
      };
    }

    if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
      const meta = document.createElement("meta");
      meta.name = "viewport";
      meta.content = "width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes";
      document.head.appendChild(meta);

      const canvas = document.querySelector("#unity-canvas");
      canvas.style.width = "100%";
      canvas.style.height = "100%";
      canvas.style.position = "fixed";
      document.body.style.textAlign = "left";
    }

    // (опционально) фон из Splash Image, если задан
    const canvas = document.querySelector("#unity-canvas");
    const bgName = "Web.jpg";
    if (bgName && bgName.length > 0) {
      canvas.style.background = "url('" + buildUrl + "/" + bgName.replace(/'/g, "%27") + "') center / cover";
    }

    window.sendToHost = function(type, payload) {
  var message = {
    type: type,
    payload: (payload !== undefined && payload !== null) ? payload : null,
    ts: Date.now()
  };

  if (window.webkit &&
      window.webkit.messageHandlers &&
      window.webkit.messageHandlers.unity) {
    window.webkit.messageHandlers.unity.postMessage(message);
    return;
  }

  console.log("[HostEvent]", message);
};

    const initParams = getInitParams();

    const config = {
      arguments: [],
      dataUrl: buildUrl + "/Web.data",
      frameworkUrl: buildUrl + "/Web.framework.js",
      codeUrl: buildUrl + "/Web.wasm",
      streamingAssetsUrl: "StreamingAssets",
      companyName: "DefaultCompany",
      productName: "Slots2",
      productVersion: "1.5.0",
    };

    const overlay = document.getElementById("loading-overlay");
    const overlaySub = document.getElementById("loading-subtext");

    function showLoading(text) {
      if (overlaySub) overlaySub.textContent = text || "";
      overlay?.classList.remove("hidden");
    }

    function hideLoading() {
      overlay?.classList.add("hidden");
      // если хочешь полностью удалить из DOM:
      setTimeout(() => overlay?.remove(), 300);
    }

    showLoading("Preparing...");

    // loader.js
    const script = document.createElement("script");
    script.src = loaderUrl;
    script.onload = () => {
      const onProgress = (progress) => {
        // progress: 0..1
        const pct = Math.round(progress * 100);
        showLoading(`Loading assets… ${pct}%`);
      };

      createUnityInstance(canvas, config, onProgress).then( (unityInstance) => {
        window.unityInstance = unityInstance;

        function resizeCanvas() {
          const dpr = window.devicePixelRatio || 1;
          const width = Math.floor(window.innerWidth * dpr);
          const height = Math.floor(window.innerHeight * dpr);

          if (canvas.width !== width || canvas.height !== height) {
            canvas.width = width;
            canvas.height = height;
          }
        }

        window.addEventListener("resize", resizeCanvas);
        window.addEventListener("orientationchange", resizeCanvas);
        resizeCanvas();

        const payload = JSON.stringify(initParams);
        unityInstance.SendMessage("Bridge", "ApplyInitParams", payload);

        hideLoading();
      });
    };

    document.body.appendChild(script);
  </script>
</body>
</html>
